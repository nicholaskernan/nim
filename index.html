<html>
  <head>
    <title>Nim</title>
    <meta charset="UTF-8" />
    <style>
      h1 {
        text-align: center;
        color: green;
      }

      .stones {
        display: flex;
      }

      .stone-piles {
        height: 80px;
        width: 50px;
        border: 1px dashed #131212;
        background-color: #ffffff;
        position: relative;
        margin-right: 20px;
      }

      .stone-piles > div {
        background-color: #cccccc;
      }

      .gray-small-stone {
        width: 20px;
        height: 10px;
        border-radius: 50%;
      }

      .gray-small-stone.to-be-deleted {
        background-color: #ff0000;
      }
    </style>
    <script>
      let piles = [];

      function getPileName(classList) {
        let className
        let nextReturned = classList.next()
        while(!nextReturned.done) {
          className = nextReturned.value
          if (className === 'stone-piles') {
            nextReturned = classList.next();
          } else {
            break
          }
        }
        return className
      }

      function stoneClicked(event) {
        console.log(event);
        // event.target.style.display = "none";
        // event.target.style.backgroundColor = "#ff0000";
        const el = event.target

        let existingPileName
        if (document.querySelector('.to-be-deleted')) {
          let existingClassList = document.querySelector('.to-be-deleted').parentNode.classList.values()
          existingPileName = getPileName(existingClassList)
        }

;
        const classNames = el.className;
        let currentPileList = el.parentNode.classList.values()
        let currentPileName = getPileName(currentPileList)

        if (existingPileName && (existingPileName !== currentPileName)) {
          alert('You must select from the same pile')
        } else {
          if (classNames.includes("to-be-deleted")) {
            el.classList.remove("to-be-deleted");
          } else {
            el.classList.add("to-be-deleted");
          }
        }
      }

      function doneClicked(event) {
        const stones = querySelectorAll(".to-be-deleted");
        // TO DO
      }

      function randomPosition(maxNum) {
        return Math.floor(Math.random() * maxNum) + "px";
      }

      function randInt(min, max) {
        return Math.round(Math.random() * (max - min)) + min;
      }

      function createStonePiles() {
        const minPiles = 3;
        const maxPiles = 5;
        const minStones = 1;
        const maxStones = 5;

        for (let i = 0; i < randInt(minPiles, maxPiles); i++) {
          piles.push(randInt(minStones, maxStones));
        }
        console.log(`createStonePiles: ${piles}`);
        return piles;
      }

      function drawStonePiles() {
        const stonesEl = document.querySelector(".stones");
        piles.forEach((pile, index) => {
          console.log(pile, index);
          const pilesEl = document.createElement("div");
          pilesEl.classList.add("stone-piles");
          pilesEl.classList.add(`piles-${index}`);
          stonesEl.appendChild(pilesEl);
          drawStones(pilesEl, pile);
        });
      }
      function drawStones(pileEl, pile) {
        for (let i = 0; i < pile; i++) {
          const stoneEl = document.createElement("div");
          stoneEl.classList.add("gray-small-stone");
          pileEl.appendChild(stoneEl);
        }
      }

      document.addEventListener("DOMContentLoaded", function(event) {
        console.log("Content loaded ", event);
        createStonePiles();
        drawStonePiles();
        const stoneNodes = document.querySelectorAll(".gray-small-stone");
        /*
        stoneNodes.forEach(stoneNode => {
          stoneNode.addEventListener("click", stoneclicked);
        });
				*/
        for (let i = 0; i < stoneNodes.length; i++) {
          const stoneNode = stoneNodes[i];
          stoneNode.addEventListener("click", stoneClicked);
        }

        document.querySelector(".done").addEventListener("click", doneClicked);
      });
    </script>
  </head>

  <body>
    <h1>Nim</h1>
    <div class="stones"></div>
    <button class="done">Done With My Turn</button>
    <ul>
      Instructions:
      <li>Take turns removing stones from a pile</li>
      <li>During your turn, you can take any number of stones from one pile</li>
      <li>You must take at least one stone</li>
      <li>Whoever takes the last stone loses</li>
    </ul>

    <script src="src/index.js"></script>
  </body>
</html>
